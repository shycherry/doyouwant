<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module name="dyw-crossword">
  <style>
    :host(.focus)
    {
      background-color: lightblue;
    }
    :host{
      display: inline-block;
    }
    .case{
      border: groove;
      position: relative;
      text-align: center;
      vertical-align: middle;
    }
    .case.focus{
      font-weight: bold;
    }
  </style>

  <template>
    <content id="cases" select=".case"></content>
  </template>
</dom-module>

<script>
  Polymer({
    is: "dyw-crossword",
    properties:{
      word:{type: String, value:""},
      orientation:{type: String, value:"vertical"},
      caseSize:{
        type: Number,
        value:100,
        observer: "resizeChildren"
      }
    },
    ready: function(){

      var onCaseOver = function(ev){
        var currentCase = ev.toElement;
        if(currentCase.classList.contains("case")){
          this.putFocus(currentCase);
        }
      }.bind(this);

      var onCaseOut = function(ev){
        var currentCase = ev.fromElement;
        if(currentCase.classList.contains("case")){
          this.removeFocus(currentCase);
        }
      }.bind(this);

      for(var idx in this.word){
        var divCase = document.createElement('div');
        divCase.className = "case";

        if(this.orientation != "vertical")
          divCase.style.display = "inline-block";

        divCase.textContent = this.word[idx];
        divCase.addEventListener("mouseover", onCaseOver);
        divCase.addEventListener("mouseout", onCaseOut);

        this.$.cases.appendChild(divCase);
      }
    },
    resizeChildren: function(){
      var cases = this.$.cases.getDistributedNodes();
      for(var idx = 0; idx < cases.length; idx++)
      {
        var divCase = cases[idx];
        divCase.style.width = this.caseSize+"px";
        divCase.style.height = this.caseSize+"px";
      }
    },
    getFocus : function()
    {
      this.classList.add("focus");
      this.style.zIndex = 1;
    },
    lostFocus : function()
    {
      this.classList.remove("focus");
      this.style.zIndex = "";
      if(this._focusedCase)
        this.removeFocus(this._focusedCase);
    },
    putFocus : function(iCase){
      if(this._focusedCase)
        this.removeFocus(this._focusedCase);
      iCase.classList.add("focus");
      this._focusedCase = iCase;
    },
    removeFocus : function(iCase){
      if(this._focusedCase == iCase){
        iCase.classList.remove("focus");
        this._focusedCase = null;
      }
    },
    focusNext : function(){
      if(this._focusedCase){
        var nextCase = this._focusedCase.nextElementSibling;
        if(nextCase){
          this.putFocus(nextCase);
        }else{
          this.removeFocus(this._focusedCase);
        }
      }
    },
    pushKey : function(iKey){
      if(this._focusedCase){
        this.setCaseText(this._focusedCase, iKey);
        this.focusNext();
      }
    },
    setCaseText : function(iCaseElt, iText){
      iCaseElt.textContent = iText;
      if(iCaseElt.linkedCase){
        iCaseElt.linkedCase.textContent = iText;
      }
    },
    getCase : function(iCaseIdx){
      if(iCaseIdx > 0 && iCaseIdx <= this.$.cases.childElementCount){
        return this.$.cases.children[iCaseIdx-1];
      }
    },
    linkCases : function(iCaseIdx, iOtherCaseElt){
      var localCase = this.getCase(iCaseIdx);
      localCase.linkedCase = iOtherCaseElt;
    }
  });
</script>
