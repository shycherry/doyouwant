<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="./dyw-crossword.html"/>

<polymer-element name="dyw-crosswords" attributes="caseSize">
<template>
  <style>
    :host{
      display: block;
      position: relative;
      width: 500px;
      height: 500px;
    }
    ::content dyw-crossword {
      color: red;
      position: absolute;
    };
  </style>
  <content id="crosswords" select="dyw-crossword"></content>
  <content id="crossmatchboxes" select="dyw-crossmatchbox"></content>
</template>
<script>
  Polymer('dyw-crosswords',{
    caseSize : 100,
    ready : function(){
      this.onMutation(this, this.childrenUpdated);
      this.childrenUpdated();
      this.addEventListener("mouseover", function(ev){
        var currentNode = ev.toElement;
        if(currentNode.nodeName == "DYW-CROSSWORD")
        {
          currentNode.classList.add("focus");
          currentNode.style.zIndex = 1;
        }
      });
      this.addEventListener("mouseout", function(ev){
        var currentNode = ev.fromElement;
        if(currentNode.nodeName == "DYW-CROSSWORD")
        {
          currentNode.classList.remove("focus");
          currentNode.style.zIndex = "";
        }
      });
    },
    childrenUpdated : function()
    {
      this.updateChildren();
      this.onMutation(this, this.childrenUpdated);
    },
    updateChildren : function()
    {
      var positions = {};
      var crosswords = this.$.crosswords.getDistributedNodes();
      for(var idx = 0; idx < crosswords.length; idx++)
      {
        var currentCrossword = crosswords[idx];
        currentCrossword.caseSize = this.caseSize;
        currentCrossword.style.top = "0px";
        currentCrossword.style.left = "0px";
        positions[currentCrossword.id] = {"x":0,"y":0};
      }

      var crosswordMatchBoxes = this.$.crossmatchboxes.getDistributedNodes();
      for(var idx = 0; idx < crosswordMatchBoxes.length; idx++)
      {
        var currentCrossMatchBox = crosswordMatchBoxes[idx];
        var crossword1 = this.querySelector('#'+currentCrossMatchBox.id1);
        var crossword2 = this.querySelector('#'+currentCrossMatchBox.id2);

        if(crossword2.orientation == "horizontal")
        {
          positions[crossword2.id].x = positions[crossword1.id].x + ((currentCrossMatchBox.n2-1)*(this.caseSize+6));
          crossword2.style.left = positions[crossword2.id].x+"px";

          positions[crossword2.id].y = positions[crossword1.id].y + ((currentCrossMatchBox.n1-1)*(this.caseSize+6));
          crossword2.style.top = positions[crossword2.id].y+"px";
        }else
        {
          positions[crossword2.id].x = positions[crossword1.id].x + ((currentCrossMatchBox.n1-1)*(this.caseSize+6));
          crossword2.style.left = positions[crossword2.id].x+"px";

          positions[crossword2.id].y = positions[crossword1.id].y - ((currentCrossMatchBox.n2-1)*(this.caseSize+6));
          crossword2.style.top = positions[crossword2.id].y+"px";
        }
      }
    },
  });
</script>
</polymer-element>
